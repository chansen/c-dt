#include "dt.h"
#include "tap.h"

const struct test {
    int y;
    int d;
    int rdn;
} tests[] = {
    {1970, 195, 719357},
    {1971, 256, 719783},
    {1972, 199, 720091},
    {1973, 331, 720589},
    {1974, 249, 720872},
    {1975,  30, 721018},
    {1976, 300, 721653},
    {1977, 217, 721936},
    {1978, 114, 722198},
    {1979,  38, 722487},
    {1980, 278, 723092},
    {1981, 300, 723480},
    {1982,  58, 723603},
    {1983, 222, 724132},
    {1984, 185, 724460},
    {1985, 324, 724965},
    {1986,  93, 725099},
    {1987, 338, 725709},
    {1988, 174, 725910},
    {1989, 350, 726452},
    {1990, 170, 726637},
    {1991, 291, 727123},
    {1992, 251, 727448},
    {1993, 214, 727777},
    {1994, 107, 728035},
    {1995,  94, 728387},
    {1996, 360, 729018},
    {1997, 164, 729188},
    {1998,  45, 729434},
    {1999, 360, 730114},
    {2000, 341, 730460},
    {2001, 133, 730618},
    {2002, 140, 730990},
    {2003, 140, 731355},
    {2004, 233, 731813},
    {2005,  22, 731968},
    {2006,  80, 732391},
    {2007, 340, 733016},
    {2008, 365, 733406},
    {2009, 254, 733661},
    {2010, 116, 733888},
    {2011, 301, 734438},
    {2012, 143, 734645},
    {2013, 106, 734974},
    {2014, 102, 735335},
    {2015, 347, 735945},
    {2016, 210, 736173},
    {2017, 277, 736606},
    {2018, 139, 736833},
    {2019,  99, 737158},
    {2020, 282, 737706},
};

int 
main() {
    int i, ntests;

    ntests = sizeof(tests) / sizeof(*tests);
    for (i = 0; i < ntests; i++) {
        const struct test t = tests[i];

        {
            int rdn = dt_rdn(dt_from_yd(t.y, t.d));
            cmp_ok(rdn, "==", t.rdn, "dt_rdn(dt_from_yd(%d, %d))", t.y, t.d);
        }

        {
            int y, d;
            dt_to_yd(dt_from_rdn(t.rdn), &y, &d);
            if (!ok((y == t.y && d == t.d), "dt_to_yd(dt_from_rdn(%d))", t.rdn)) {
                diag("     got: %.4d-%.3d", y, d);
                diag("     exp: %.4d-%.3d", t.y, t.d);
            }
        }

        {
            int got = dt_year(dt_from_rdn(t.rdn));
            cmp_ok(got, "==", t.y, "dt_year(dt_from_rdn(%d))", t.rdn);
        }

        {
            int got = dt_day_of_year(dt_from_rdn(t.rdn));
            cmp_ok(got, "==", t.d, "dt_day_of_year(dt_from_rdn(%d))", t.rdn);
        }

        {
            ok(dt_valid_yd(t.y, t.d), "dt_valid_yd(%d, %d)", t.y, t.d);
        }

    }
    done_testing();
}
