#include "dt.h"
#include "tap.h"

const struct test {
    int y1;
    int m1;
    int d1;
    int y2;
    int m2;
    int d2;
    int exp;
    bool inclusive;
} tests[] = {
    {2012,  1,  2, 2012,  1,  2,   1, 1},
    {2012,  1,  2, 2012,  1,  3,   2, 1},
    {2012,  1,  2, 2012,  1,  4,   3, 1},
    {2012,  1,  2, 2012,  1,  5,   4, 1},
    {2012,  1,  2, 2012,  1,  6,   5, 1},
    {2012,  1,  2, 2012,  1,  7,   5, 1},
    {2012,  1,  2, 2012,  1,  8,   5, 1},
    {2012,  1,  2, 2011, 11,  7, -41, 1},
    {2012,  1,  2, 2011, 11,  8, -40, 1},
    {2012,  1,  2, 2011, 11,  9, -39, 1},
    {2012,  1,  2, 2011, 11, 10, -38, 1},
    {2012,  1,  2, 2011, 11, 11, -37, 1},
    {2012,  1,  2, 2011, 11, 12, -36, 1},
    {2012,  1,  2, 2011, 11, 13, -36, 1},
    {2012,  1,  3, 2012,  1,  2,  -2, 1},
    {2012,  1,  3, 2012,  1,  3,   1, 1},
    {2012,  1,  3, 2012,  1,  4,   2, 1},
    {2012,  1,  3, 2012,  1,  5,   3, 1},
    {2012,  1,  3, 2012,  1,  6,   4, 1},
    {2012,  1,  3, 2012,  1,  7,   4, 1},
    {2012,  1,  3, 2012,  1,  8,   4, 1},
    {2012,  1,  3, 2011, 11,  7, -42, 1},
    {2012,  1,  3, 2011, 11,  8, -41, 1},
    {2012,  1,  3, 2011, 11,  9, -40, 1},
    {2012,  1,  3, 2011, 11, 10, -39, 1},
    {2012,  1,  3, 2011, 11, 11, -38, 1},
    {2012,  1,  3, 2011, 11, 12, -37, 1},
    {2012,  1,  3, 2011, 11, 13, -37, 1},
    {2012,  1,  4, 2012,  1,  2,  -3, 1},
    {2012,  1,  4, 2012,  1,  3,  -2, 1},
    {2012,  1,  4, 2012,  1,  4,   1, 1},
    {2012,  1,  4, 2012,  1,  5,   2, 1},
    {2012,  1,  4, 2012,  1,  6,   3, 1},
    {2012,  1,  4, 2012,  1,  7,   3, 1},
    {2012,  1,  4, 2012,  1,  8,   3, 1},
    {2012,  1,  4, 2011, 11,  7, -43, 1},
    {2012,  1,  4, 2011, 11,  8, -42, 1},
    {2012,  1,  4, 2011, 11,  9, -41, 1},
    {2012,  1,  4, 2011, 11, 10, -40, 1},
    {2012,  1,  4, 2011, 11, 11, -39, 1},
    {2012,  1,  4, 2011, 11, 12, -38, 1},
    {2012,  1,  4, 2011, 11, 13, -38, 1},
    {2012,  1,  5, 2012,  1,  2,  -4, 1},
    {2012,  1,  5, 2012,  1,  3,  -3, 1},
    {2012,  1,  5, 2012,  1,  4,  -2, 1},
    {2012,  1,  5, 2012,  1,  5,   1, 1},
    {2012,  1,  5, 2012,  1,  6,   2, 1},
    {2012,  1,  5, 2012,  1,  7,   2, 1},
    {2012,  1,  5, 2012,  1,  8,   2, 1},
    {2012,  1,  5, 2011, 11,  7, -44, 1},
    {2012,  1,  5, 2011, 11,  8, -43, 1},
    {2012,  1,  5, 2011, 11,  9, -42, 1},
    {2012,  1,  5, 2011, 11, 10, -41, 1},
    {2012,  1,  5, 2011, 11, 11, -40, 1},
    {2012,  1,  5, 2011, 11, 12, -39, 1},
    {2012,  1,  5, 2011, 11, 13, -39, 1},
    {2012,  1,  6, 2012,  1,  2,  -5, 1},
    {2012,  1,  6, 2012,  1,  3,  -4, 1},
    {2012,  1,  6, 2012,  1,  4,  -3, 1},
    {2012,  1,  6, 2012,  1,  5,  -2, 1},
    {2012,  1,  6, 2012,  1,  6,   1, 1},
    {2012,  1,  6, 2012,  1,  7,   1, 1},
    {2012,  1,  6, 2012,  1,  8,   1, 1},
    {2012,  1,  6, 2011, 11,  7, -45, 1},
    {2012,  1,  6, 2011, 11,  8, -44, 1},
    {2012,  1,  6, 2011, 11,  9, -43, 1},
    {2012,  1,  6, 2011, 11, 10, -42, 1},
    {2012,  1,  6, 2011, 11, 11, -41, 1},
    {2012,  1,  6, 2011, 11, 12, -40, 1},
    {2012,  1,  6, 2011, 11, 13, -40, 1},
    {2012,  1,  7, 2012,  1,  2,  -5, 1},
    {2012,  1,  7, 2012,  1,  3,  -4, 1},
    {2012,  1,  7, 2012,  1,  4,  -3, 1},
    {2012,  1,  7, 2012,  1,  5,  -2, 1},
    {2012,  1,  7, 2012,  1,  6,  -1, 1},
    {2012,  1,  7, 2012,  1,  7,   0, 1},
    {2012,  1,  7, 2012,  1,  8,   0, 1},
    {2012,  1,  7, 2011, 11,  7, -45, 1},
    {2012,  1,  7, 2011, 11,  8, -44, 1},
    {2012,  1,  7, 2011, 11,  9, -43, 1},
    {2012,  1,  7, 2011, 11, 10, -42, 1},
    {2012,  1,  7, 2011, 11, 11, -41, 1},
    {2012,  1,  7, 2011, 11, 12, -40, 1},
    {2012,  1,  7, 2011, 11, 13, -40, 1},
    {2012,  1,  8, 2012,  1,  2,  -5, 1},
    {2012,  1,  8, 2012,  1,  3,  -4, 1},
    {2012,  1,  8, 2012,  1,  4,  -3, 1},
    {2012,  1,  8, 2012,  1,  5,  -2, 1},
    {2012,  1,  8, 2012,  1,  6,  -1, 1},
    {2012,  1,  8, 2012,  1,  7,   0, 1},
    {2012,  1,  8, 2012,  1,  8,   0, 1},
    {2012,  1,  8, 2011, 11,  7, -45, 1},
    {2012,  1,  8, 2011, 11,  8, -44, 1},
    {2012,  1,  8, 2011, 11,  9, -43, 1},
    {2012,  1,  8, 2011, 11, 10, -42, 1},
    {2012,  1,  8, 2011, 11, 11, -41, 1},
    {2012,  1,  8, 2011, 11, 12, -40, 1},
    {2012,  1,  8, 2011, 11, 13, -40, 1},
};

int 
main() {
    int i, ntests;

    ntests = sizeof(tests) / sizeof(*tests);
    for (i = 0; i < ntests; i++) {
        const struct test t = tests[i];

        {
            int got;
            dt_t dt1 = dt_from_ymd(t.y1, t.m1, t.d1);
            dt_t dt2 = dt_from_ymd(t.y2, t.m2, t.d2);

            got = dt_delta_weekdays(dt1, dt2, t.inclusive);
            cmp_ok(got, "==", t.exp, "dt_delta_weekdays(%.4d-%.2d-%.2d, %.4d-%.2d-%.2d, %s)", 
              t.y1, t.m1, t.d1, t.y2, t.m2, t.d2, (t.inclusive ? "true" : "false"));
        }
    }
    done_testing();
}

