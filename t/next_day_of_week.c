#include "dt.h"
#include "tap.h"

const struct test {
    int  y;
    int  w;
    int  d;
    int  dow;
    bool current;
    int  ey;
    int  ew;
    int  ed;
} tests[] = {
    {2012, 10, 1, 1, 1, 2012, 10, 1},
    {2012, 10, 2, 2, 1, 2012, 10, 2},
    {2012, 10, 3, 3, 1, 2012, 10, 3},
    {2012, 10, 4, 4, 1, 2012, 10, 4},
    {2012, 10, 5, 5, 1, 2012, 10, 5},
    {2012, 10, 6, 6, 1, 2012, 10, 6},
    {2012, 10, 7, 7, 1, 2012, 10, 7},
    {2012, 10, 1, 2, 1, 2012, 10, 2},
    {2012, 10, 2, 3, 1, 2012, 10, 3},
    {2012, 10, 3, 4, 1, 2012, 10, 4},
    {2012, 10, 4, 5, 1, 2012, 10, 5},
    {2012, 10, 5, 6, 1, 2012, 10, 6},
    {2012, 10, 6, 7, 1, 2012, 10, 7},
    {2012, 10, 7, 1, 1, 2012, 11, 1},
    {2012, 10, 1, 1, 0, 2012, 11, 1},
    {2012, 10, 2, 2, 0, 2012, 11, 2},
    {2012, 10, 3, 3, 0, 2012, 11, 3},
    {2012, 10, 4, 4, 0, 2012, 11, 4},
    {2012, 10, 5, 5, 0, 2012, 11, 5},
    {2012, 10, 6, 6, 0, 2012, 11, 6},
    {2012, 10, 7, 7, 0, 2012, 11, 7},
    {2012, 10, 1, 2, 0, 2012, 10, 2},
    {2012, 10, 2, 3, 0, 2012, 10, 3},
    {2012, 10, 3, 4, 0, 2012, 10, 4},
    {2012, 10, 4, 5, 0, 2012, 10, 5},
    {2012, 10, 5, 6, 0, 2012, 10, 6},
    {2012, 10, 6, 7, 0, 2012, 10, 7},
    {2012, 10, 7, 1, 0, 2012, 11, 1},
};

int 
main() {
    int i, ntests;

    ntests = sizeof(tests) / sizeof(*tests);
    for (i = 0; i < ntests; i++) {
        const struct test t = tests[i];

        {
            dt_t src = dt_from_ywd(t.y, t.w, t.d);
            dt_t got = dt_next_day_of_week(src, t.dow, t.current);
            dt_t exp = dt_from_ywd(t.ey, t.ew, t.ed);
            cmp_ok(got, "==", exp, "dt_next_day_of_week(%d, %d, %d)", src, t.dow, t.current);
        }

    }
    done_testing();
}
