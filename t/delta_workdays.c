#include "dt.h"
#include "tap.h"

const struct test {
    int y1;
    int m1;
    int d1;
    int y2;
    int m2;
    int d2;
    int exp;
    bool inclusive;
} tests[] = {
    {2013,  1,  1, 2013,  1,  2,    1, 1},
    {2013,  3, 28, 2013,  4,  2,    2, 1},
    {2013,  3, 28, 2013,  4,  3,    3, 1},
    {2013,  3, 28, 2013,  4,  4,    4, 1},
    {2013,  3, 28, 2013,  4,  5,    5, 1},
    {2013,  3, 29, 2013,  4,  2,    1, 1},
    {2013,  3, 29, 2013,  4,  3,    2, 1},
    {2013,  3, 29, 2013,  4,  4,    3, 1},
    {2013,  3, 29, 2013,  4,  5,    4, 1},
    {2013,  3, 30, 2013,  4,  2,    1, 1},
    {2013,  3, 30, 2013,  4,  3,    2, 1},
    {2013,  3, 30, 2013,  4,  4,    3, 1},
    {2013,  3, 30, 2013,  4,  5,    4, 1},
    {2013,  3, 31, 2013,  4,  2,    1, 1},
    {2013,  3, 31, 2013,  4,  3,    2, 1},
    {2013,  3, 31, 2013,  4,  4,    3, 1},
    {2013,  3, 31, 2013,  4,  5,    4, 1},
    {2013,  4,  1, 2013,  4,  2,    1, 1},
    {2013,  4,  1, 2013,  4,  3,    2, 1},
    {2013,  4,  1, 2013,  4,  4,    3, 1},
    {2013,  4,  1, 2013,  4,  5,    4, 1},
    {2013,  4,  2, 2013,  4,  3,    2, 1},
    {2013,  4,  2, 2013,  4,  4,    3, 1},
    {2013,  4,  2, 2013,  4,  5,    4, 1},
    {2013,  4,  2, 2013,  4,  8,    5, 1},
    {2013,  4,  2, 2013,  3, 28,   -2, 1},
    {2013,  4,  2, 2013,  3, 27,   -3, 1},
    {2013,  4,  2, 2013,  3, 26,   -4, 1},
    {2013,  4,  2, 2013,  3, 25,   -5, 1},
    {2013,  4,  1, 2013,  3, 28,   -1, 1},
    {2013,  4,  1, 2013,  3, 27,   -2, 1},
    {2013,  4,  1, 2013,  3, 26,   -3, 1},
    {2013,  4,  1, 2013,  3, 25,   -4, 1},
    {2013,  3, 31, 2013,  3, 28,   -1, 1},
    {2013,  3, 31, 2013,  3, 27,   -2, 1},
    {2013,  3, 31, 2013,  3, 26,   -3, 1},
    {2013,  3, 31, 2013,  3, 25,   -4, 1},
    {2013,  3, 31, 2013,  3, 28,   -1, 1},
    {2013,  3, 30, 2013,  3, 28,   -1, 1},
    {2013,  3, 30, 2013,  3, 27,   -2, 1},
    {2013,  3, 30, 2013,  3, 26,   -3, 1},
    {2013,  3, 30, 2013,  3, 25,   -4, 1},
    {2013,  3, 29, 2013,  3, 28,   -1, 1},
    {2013,  3, 29, 2013,  3, 27,   -2, 1},
    {2013,  3, 29, 2013,  3, 26,   -3, 1},
    {2013,  3, 29, 2013,  3, 25,   -4, 1},
    {2013,  3, 28, 2013,  3, 27,   -2, 1},
    {2013,  3, 28, 2013,  3, 26,   -3, 1},
    {2013,  3, 28, 2013,  3, 25,   -4, 1},
    {2013,  3, 28, 2013,  3, 22,   -5, 1},
    {2013,  6,  1, 2013,  6,  7,    4, 1},
    {2013, 12, 20, 2014,  1,  1,    5, 1},
    {2013, 12, 23, 2013, 12, 27,    2, 1},
    {2013, 12, 24, 2013, 12, 27,    1, 1},
    {2013, 12, 25, 2013, 12, 23,   -1, 1},
    {2013, 12, 26, 2013, 12, 23,   -1, 1},
    {2013, 12, 27, 2013, 12, 23,   -2, 1},
    {2013, 12, 27, 2013, 12, 30,    2, 1},
    {2013,  1,  1, 2013, 12, 30,  250, 1},
    {2013,  1,  1, 2014,  1,  1,  251, 1},
    {2013,  1,  2, 2014,  1,  1,  251, 1},
    {2013,  1,  1, 2012,  3, 27, -200, 1},
    {2013, 12, 30, 2012, 12, 31, -251, 1},
    {2013, 12, 31, 2013,  1,  2, -250, 1},
    {2011,  6,  1, 2014,  5, 30,  772, 1},
    {2014,  5, 30, 2011,  6,  1, -772, 1},
    {2013,  3, 28, 2013,  4,  1,    1, 1},
    {2013,  3, 29, 2013,  4,  1,    0, 1},
    {2013,  3, 30, 2013,  4,  1,    0, 1},
    {2013,  3, 31, 2013,  4,  1,    0, 1},
    {2013,  4,  1, 2013,  3, 28,   -1, 1},
    {2013,  4,  1, 2013,  3, 29,    0, 1},
    {2013,  4,  1, 2013,  3, 30,    0, 1},
    {2013,  4,  1, 2013,  3, 31,    0, 1},
    {2013,  3, 28, 2013,  4,  2,    2, 1},
    {2013,  3, 29, 2013,  4,  2,    1, 1},
    {2013,  3, 30, 2013,  4,  2,    1, 1},
    {2013,  3, 31, 2013,  4,  2,    1, 1},
    {2013, 12, 24, 2013, 12, 26,    0, 1},
    {2013, 12, 26, 2013, 12, 24,    0, 1},
    {2011,  6,  1, 2014,  6,  1,  772, 1},
    {2014,  6,  1, 2011,  6,  1, -772, 1},
};

const struct ymd {
    int y;
    int m;
    int d;
} days[] = {
    {2013,  1,  1}, /* Tuesday, Nyårsdagen (New Year's Day) */
    {2013,  3, 29}, /* Friday, Långfredagen (Good Friday) */
    {2013,  4,  1}, /* Monday, Annandag påsk (Easter Monday) */
    {2013,  5,  1}, /* Wednesday, Första maj (First of May) */
    {2013,  5,  9}, /* Thursday, Kristi himmelsfärds dag (Ascension Day) */
    {2013,  6,  6}, /* Thursday, Sveriges nationaldag (National Day of Sweden) */
    {2013,  6, 21}, /* Friday, Midsommarafton (Midsummer's Eve) */
    {2013, 12, 24}, /* Tuesday, Julafton (Christmas Eve) */
    {2013, 12, 25}, /* Wednesday, Juldagen (Christmas Day) */
    {2013, 12, 26}, /* Thursday, Annandag jul (Boxing Day) */
    {2013, 12, 31}, /* Tuesday, Nyårsafton (New Year's Eve) */
};

int 
main() {
    int ntests, nholidays;
    int i;
    dt_t holidays[20];

    nholidays = sizeof(days) / sizeof(*days);
    for (i = 0; i < nholidays; i++) {
        const struct ymd date = days[i];
        holidays[i] = dt_from_ymd(date.y, date.m, date.d);
    }

    ntests = sizeof(tests) / sizeof(*tests);
    for (i = 0; i < ntests; i++) {
        const struct test t = tests[i];

        {
            int got;
            dt_t dt1 = dt_from_ymd(t.y1, t.m1, t.d1);
            dt_t dt2 = dt_from_ymd(t.y2, t.m2, t.d2);

            got = dt_delta_workdays(dt1, dt2, t.inclusive, holidays, nholidays);
            cmp_ok(got, "==", t.exp, "dt_delta_workdays(%.4d-%.2d-%.2d, %.4d-%.2d-%.2d, %s)", 
              t.y1, t.m1, t.d1, t.y2, t.m2, t.d2, (t.inclusive ? "true" : "false"));
        }
    }
    done_testing();
}

