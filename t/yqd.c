#include "dt.h"
#include "tap.h"

const struct test {
    int y;
    int q;
    int d;
    int rdn;
} tests[] = {
    {2000, 1, 38, 730157},
    {2000, 2, 21, 730231},
    {2000, 3, 82, 730383},
    {2000, 4, 11, 730404},
    {2001, 1, 60, 730545},
    {2001, 2, 67, 730642},
    {2001, 3, 35, 730701},
    {2001, 4, 52, 730810},
    {2002, 1, 14, 730864},
    {2002, 2, 55, 730995},
    {2002, 3, 50, 731081},
    {2002, 4, 47, 731170},
    {2003, 1, 38, 731253},
    {2003, 2, 25, 731330},
    {2003, 3, 28, 731424},
    {2003, 4,  2, 731490},
    {2004, 1, 69, 731649},
    {2004, 2, 13, 731684},
    {2004, 3, 91, 731853},
    {2004, 4, 79, 731933},
    {2005, 1, 41, 731987},
    {2005, 2, 16, 732052},
    {2005, 3, 20, 732147},
    {2005, 4, 81, 732300},
    {2006, 1, 20, 732331},
    {2006, 2, 11, 732412},
    {2006, 3, 12, 732504},
    {2006, 4, 55, 732639},
    {2007, 1, 68, 732744},
    {2007, 2, 27, 732793},
    {2007, 3, 81, 732938},
    {2007, 4, 21, 732970},
    {2008, 1, 54, 733095},
    {2008, 2, 27, 733159},
    {2008, 3, 81, 733304},
    {2008, 4, 66, 733381},
    {2009, 1, 74, 733481},
    {2009, 2, 30, 733527},
    {2009, 3, 17, 733605},
    {2009, 4, 85, 733765},
    {2010, 1, 84, 733856},
    {2010, 2, 85, 733947},
    {2010, 3,  6, 733959},
    {2010, 4, 51, 734096},
    {2011, 1, 51, 734188},
    {2011, 2, 39, 734266},
    {2011, 3,  2, 734320},
    {2011, 4, 62, 734472},
    {2012, 1, 17, 734519},
    {2012, 2, 56, 734649},
    {2012, 3, 89, 734773},
    {2012, 4,  2, 734778},
    {2013, 1, 21, 734889},
    {2013, 2, 38, 734996},
    {2013, 3, 90, 735139},
    {2013, 4, 14, 735155},
    {2014, 1, 24, 735257},
    {2014, 2, 39, 735362},
    {2014, 3, 49, 735463},
    {2014, 4, 11, 735517},
    {2015, 1, 87, 735685},
    {2015, 2, 80, 735768},
    {2015, 3, 72, 735851},
    {2015, 4, 34, 735905},
    {2016, 1, 59, 736022},
    {2016, 2, 23, 736077},
    {2016, 3, 35, 736180},
    {2016, 4, 60, 736297},
    {2017, 1,  7, 736336},
    {2017, 2, 32, 736451},
    {2017, 3,  8, 736518},
    {2017, 4,  4, 736606},
    {2018, 1, 12, 736706},
    {2018, 2, 91, 736875},
    {2018, 3, 17, 736892},
    {2018, 4, 42, 737009},
    {2019, 1, 35, 737094},
    {2019, 2, 16, 737165},
    {2019, 3, 81, 737321},
    {2019, 4, 77, 737409},
    {2020, 1, 82, 737506},
    {2020, 2, 12, 737527},
    {2020, 3, 12, 737618},
    {2020, 4, 60, 737758},
};

int 
main() {
    int i, ntests;

    ntests = sizeof(tests) / sizeof(*tests);
    for (i = 0; i < ntests; i++) {
        const struct test t = tests[i];

        {
            dt_t got = dt_rdn(dt_from_yqd(t.y, t.q, t.d));
            cmp_ok(got, "==", t.rdn, "dt_from_yqd(%d, %d, %d)", t.y, t.q, t.d);
        }

        {
            int y, q, d;
            dt_to_yqd(dt_from_rdn(t.rdn), &y, &q, &d);
            if (!ok((y == t.y && q == t.q && d == t.d), "dt_to_yqd(dt_from_rdn(%d))", t.rdn)) {
                diag("     got: %.4d-Q%d-%.2d", y, q, d);
                diag("     exp: %.4d-Q%d-%.2d", t.y, t.q, t.d);
            }
        }

        {
            int got = dt_year(dt_from_rdn(t.rdn));
            cmp_ok(got, "==", t.y, "dt_year(dt_from_rdn(%d))", t.rdn);
        }

        {
            int got = dt_quarter(dt_from_rdn(t.rdn));
            cmp_ok(got, "==", t.q, "dt_quarter(dt_from_rdn(%d))", t.rdn);
        }

        {
            int got = dt_doq(dt_from_rdn(t.rdn));
            cmp_ok(got, "==", t.d, "dt_doq(dt_from_rdn(%d))", t.rdn);
        }

        {
            ok(dt_valid_yqd(t.y, t.q, t.d), "dt_valid_yqd(%d, %d, %d)", t.y, t.q, t.d);
        }

    }
    done_testing();
}
