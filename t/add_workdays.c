#include "dt.h"
#include "tap.h"

const struct test {
    int y;
    int m;
    int d; 
    int delta;
    int ey;
    int em;
    int ed;
} tests[] = {
    {2013,  1,  1,    1, 2013,  1,  2},
    {2013,  3, 28,    1, 2013,  4,  2},
    {2013,  3, 28,    2, 2013,  4,  3},
    {2013,  3, 28,    3, 2013,  4,  4},
    {2013,  3, 28,    4, 2013,  4,  5},
    {2013,  3, 29,    1, 2013,  4,  2},
    {2013,  3, 29,    2, 2013,  4,  3},
    {2013,  3, 29,    3, 2013,  4,  4},
    {2013,  3, 29,    4, 2013,  4,  5},
    {2013,  3, 30,    1, 2013,  4,  2},
    {2013,  3, 30,    2, 2013,  4,  3},
    {2013,  3, 30,    3, 2013,  4,  4},
    {2013,  3, 30,    4, 2013,  4,  5},
    {2013,  3, 31,    1, 2013,  4,  2},
    {2013,  3, 31,    2, 2013,  4,  3},
    {2013,  3, 31,    3, 2013,  4,  4},
    {2013,  3, 31,    4, 2013,  4,  5},
    {2013,  4,  1,    1, 2013,  4,  2},
    {2013,  4,  1,    2, 2013,  4,  3},
    {2013,  4,  1,    3, 2013,  4,  4},
    {2013,  4,  1,    4, 2013,  4,  5},
    {2013,  4,  2,    1, 2013,  4,  3},
    {2013,  4,  2,    2, 2013,  4,  4},
    {2013,  4,  2,    3, 2013,  4,  5},
    {2013,  4,  2,    4, 2013,  4,  8},
    {2013,  4,  2,   -1, 2013,  3, 28},
    {2013,  4,  2,   -2, 2013,  3, 27},
    {2013,  4,  2,   -3, 2013,  3, 26},
    {2013,  4,  2,   -4, 2013,  3, 25},
    {2013,  4,  1,   -1, 2013,  3, 28},
    {2013,  4,  1,   -2, 2013,  3, 27},
    {2013,  4,  1,   -3, 2013,  3, 26},
    {2013,  4,  1,   -4, 2013,  3, 25},
    {2013,  3, 31,   -1, 2013,  3, 28},
    {2013,  3, 31,   -2, 2013,  3, 27},
    {2013,  3, 31,   -3, 2013,  3, 26},
    {2013,  3, 31,   -4, 2013,  3, 25},
    {2013,  3, 31,   -1, 2013,  3, 28},
    {2013,  3, 30,   -1, 2013,  3, 28},
    {2013,  3, 30,   -2, 2013,  3, 27},
    {2013,  3, 30,   -3, 2013,  3, 26},
    {2013,  3, 30,   -4, 2013,  3, 25},
    {2013,  3, 29,   -1, 2013,  3, 28},
    {2013,  3, 29,   -2, 2013,  3, 27},
    {2013,  3, 29,   -3, 2013,  3, 26},
    {2013,  3, 29,   -4, 2013,  3, 25},
    {2013,  3, 28,   -1, 2013,  3, 27},
    {2013,  3, 28,   -2, 2013,  3, 26},
    {2013,  3, 28,   -3, 2013,  3, 25},
    {2013,  3, 28,   -4, 2013,  3, 22},
    {2013,  6,  1,    4, 2013,  6,  7},
    {2013, 12, 20,    4, 2014,  1,  1},
    {2013, 12, 23,    1, 2013, 12, 27},
    {2013, 12, 24,    1, 2013, 12, 27},
    {2013, 12, 25,   -1, 2013, 12, 23},
    {2013, 12, 26,   -1, 2013, 12, 23},
    {2013, 12, 27,   -1, 2013, 12, 23},
    {2013, 12, 27,    1, 2013, 12, 30},
    {2013,  1,  1,  250, 2013, 12, 30},
    {2013,  1,  1,  251, 2014,  1,  1},
    {2013,  1,  2,  250, 2014,  1,  1},
    {2013,  1,  1, -200, 2012,  3, 27},
    {2013, 12, 30, -250, 2012, 12, 31},
    {2013, 12, 31, -250, 2013,  1,  2},
    {2011,  6,  1,  771, 2014,  5, 30},
    {2014,  5, 30, -771, 2011,  6,  1},
    {2013,  6,  1,    0, 2013,  6,  1},
    {2013,  6,  6,    0, 2013,  6,  6},
};

const struct ymd {
    int y;
    int m;
    int d;
} days[] = {
    {2013,  1,  1}, /* Tuesday, Nyårsdagen (New Year's Day) */
    {2013,  3, 29}, /* Friday, Långfredagen (Good Friday) */
    {2013,  4,  1}, /* Monday, Annandag påsk (Easter Monday) */
    {2013,  5,  1}, /* Wednesday, Första maj (First of May) */
    {2013,  5,  9}, /* Thursday, Kristi himmelsfärds dag (Ascension Day) */
    {2013,  6,  6}, /* Thursday, Sveriges nationaldag (National Day of Sweden) */
    {2013,  6, 21}, /* Friday, Midsommarafton (Midsummer's Eve) */
    {2013, 12, 24}, /* Tuesday, Julafton (Christmas Eve) */
    {2013, 12, 25}, /* Wednesday, Juldagen (Christmas Day) */
    {2013, 12, 26}, /* Thursday, Annandag jul (Boxing Day) */
    {2013, 12, 31}, /* Tuesday, Nyårsafton (New Year's Eve) */
};

int
main() {
    int ntests, nholidays;
    int i;
    dt_t holidays[20];

    nholidays = sizeof(days) / sizeof(*days);
    for (i = 0; i < nholidays; i++) {
        const struct ymd date = days[i];
        holidays[i] = dt_from_ymd(date.y, date.m, date.d);
    }

    ntests = sizeof(tests) / sizeof(*tests);
    for (i = 0; i < ntests; i++) {
        const struct test t = tests[i];

        {
            dt_t src = dt_from_ymd(t.y, t.m, t.d);
            dt_t got = dt_add_workdays(src, t.delta, holidays, nholidays);
            dt_t exp = dt_from_ymd(t.ey, t.em, t.ed);
            cmp_ok(got, "==", exp, "dt_add_workdays(%.4d-%.2d-%.2d, %d)", 
              src, t.y, t.m, t.d, t.delta);
        }
    }
    done_testing();
}

