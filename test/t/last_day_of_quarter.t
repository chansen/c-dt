#!perl
use strict;
use warnings;

use Test::More 0.88;
use dtp qw[:all];

while (<DATA>) {
    next if /\A \# /x;
    chomp;
    my ($y, $q, $d, $delta, $ey, $eq, $ed) = split /,\s*/, $_;

    {
        my $dt = dt_from_yqd($y, $q, $d);
        my $exp = sprintf '%.4d-Q%d-%.2d', $ey, $eq, $ed;
        my $got = sprintf '%.4d-Q%d-%.2d', dt_to_yqd(dt_last_day_of_quarter($dt, $delta));
        is($got, $exp, "dt_last_day_of_quarter($dt, $delta)");
    }

    {
        my $dt1 = dt_from_yqd($y, $q, $d);
        my $dt2 = dt_last_day_of_quarter($dt1, $delta);
        my $got = dt_delta_quarters($dt1, $dt2);
        is($got, $delta, sprintf '%.4d-Q%d-%.2d -- %.4d-Q%d-%.2d', $y, $q, $d, $ey, $eq, 1);
    }
}

done_testing;

__DATA__
2000, 1, 71,  -1, 1999, 4, 92
2000, 2, 63,   3, 2001, 1, 90
2000, 3, 49, -15, 1996, 4, 92
2000, 4, 86,  -6, 1999, 2, 91
2001, 1, 48,   2, 2001, 3, 92
2001, 2, 63,  17, 2005, 3, 92
2001, 3, 25, -21, 1996, 2, 91
2001, 4, 67,  15, 2005, 3, 92
2002, 1, 22,   2, 2002, 3, 92
2002, 2, 39,   8, 2004, 2, 91
2002, 3, 68, -10, 2000, 1, 91
2002, 4, 78,  10, 2005, 2, 91
2003, 1, 43, -16, 1999, 1, 90
2003, 2, 51, -17, 1999, 1, 90
2003, 3, 78, -24, 1997, 3, 92
2003, 4, 50, -16, 1999, 4, 92
2004, 1, 69, -16, 2000, 1, 91
2004, 2, 89,  21, 2009, 3, 92
2004, 3, 10,   9, 2006, 4, 92
2004, 4, 75, -15, 2001, 1, 90
2005, 1, 13,  20, 2010, 1, 90
2005, 2, 64, -17, 2001, 1, 90
2005, 3, 35,  14, 2009, 1, 90
2005, 4, 48,   3, 2006, 3, 92
2006, 1, 67,  19, 2010, 4, 92
2006, 2,  8,   9, 2008, 3, 92
2006, 3, 42, -23, 2000, 4, 92
2006, 4, 24,  -3, 2006, 1, 90
2007, 1, 10, -22, 2001, 3, 92
2007, 2, 41,  18, 2011, 4, 92
2007, 3, 74,  21, 2012, 4, 92
2007, 4, 55, -13, 2004, 3, 92
2008, 1, 62,   4, 2009, 1, 90
2008, 2, 21, -17, 2004, 1, 91
2008, 3, 73,   3, 2009, 2, 91
2008, 4,  2, -23, 2003, 1, 90
2009, 1, 75,  23, 2014, 4, 92
2009, 2, 56,  16, 2013, 2, 91
2009, 3, 69,   9, 2011, 4, 92
2009, 4, 67,  -9, 2007, 3, 92
2010, 1, 73,  -8, 2008, 1, 91
2010, 2, 31,  21, 2015, 3, 92
2010, 3, 92,  18, 2015, 1, 90
2010, 4, 91,  -8, 2008, 4, 92
2011, 1, 29,   7, 2012, 4, 92
2011, 2, 73,  -3, 2010, 3, 92
2011, 3, 13, -11, 2008, 4, 92
2011, 4, 72,  -9, 2009, 3, 92
2012, 1, 72, -17, 2007, 4, 92
2012, 2, 36, -24, 2006, 2, 91
2012, 3, 12,  12, 2015, 3, 92
2012, 4,  3,   8, 2014, 4, 92
2013, 1, 74,  16, 2017, 1, 90
2013, 2, 34, -22, 2007, 4, 92
2013, 3, 69, -19, 2008, 4, 92
2013, 4, 35, -22, 2008, 2, 91
2014, 1, 44,  12, 2017, 1, 90
2014, 2, 37,  15, 2018, 1, 90
2014, 3, 31,  22, 2020, 1, 91
2014, 4, 27,  19, 2019, 3, 92
2015, 1,  9,  20, 2020, 1, 91
2015, 2, 32, -16, 2011, 2, 91
2015, 3, 23,  18, 2020, 1, 91
2015, 4,  4, -18, 2011, 2, 91
2016, 1, 32,  15, 2019, 4, 92
2016, 2, 33,   9, 2018, 3, 92
2016, 3, 60,  22, 2022, 1, 90
2016, 4, 56, -21, 2011, 3, 92
2017, 1, 42,  20, 2022, 1, 90
2017, 2, 25,   3, 2018, 1, 90
2017, 3, 77,   0, 2017, 3, 92
2017, 4, 25, -15, 2014, 1, 90
2018, 1, 84,  -8, 2016, 1, 91
2018, 2, 26,  18, 2022, 4, 92
2018, 3,  9,   3, 2019, 2, 91
2018, 4, 50, -14, 2015, 2, 91
2019, 1, 83,   7, 2020, 4, 92
2019, 2, 80,  -6, 2017, 4, 92
2019, 3, 32,   3, 2020, 2, 91
2019, 4, 50,   5, 2021, 1, 90
2020, 1, 59, -18, 2015, 3, 92
2020, 2, 42,  11, 2023, 1, 90
2020, 3, 85, -16, 2016, 3, 92
2020, 4, 33, -13, 2017, 3, 92
