#!perl
use strict;
use warnings;

use Test::More 0.88;
use dtp qw[:all];

while (<DATA>) {
    next if /\A \# /x;
    chomp;
    my ($cy, $cm, $cd, $wy, $wn, $wd) = split /,\s*/, $_;

    my $ymd = sprintf '%.4d-%.2d-%.2d', $cy, $cm, $cd;
    my $ywd = sprintf '%.4d-W%.2d-%d',  $wy, $wn, $wd;

    my $dt = dt_from_ywd($wy, $wn, $wd);

    {
        my $got = sprintf '%.4d-%.2d-%.2d', dt_to_ymd($dt);
        is($got, $ymd, "dt_to_ymd(dt_from_ywd($wy, $wn, $wd))");
    }

    {
        my $got = dt_day_of_week($dt);
        is($got, $wd, "dt_day_of_week(dt_from_ywd($wy, $wn, $wd))");
    }

    {
        my $got = sprintf '%.4d-W%.2d-%d', dt_to_ywd(dt_from_ymd($cy, $cm, $cd));
        is($got, $ywd, "dt_to_ywd(dt_from_ymd($cy, $cm, $cd))");
    }

    {
        my $got = dt_week($dt);
        is($got, $wn, "dt_week($dt)");
    }

    {
        my $got = dt_valid_ywd($wy, $wn, $wd);
        is($got, !0, "dt_valid_ywd($wy, $wn, $wd)");
    }
}

done_testing;

__DATA__
# Test cases extracted from <http://www.merlyn.demon.co.uk/wknotest.txt>
1999, 12, 27, 1999, 52, 1
1999, 12, 28, 1999, 52, 2
1999, 12, 29, 1999, 52, 3
1999, 12, 30, 1999, 52, 4
1999, 12, 31, 1999, 52, 5
2000,  1,  1, 1999, 52, 6
2000,  1,  2, 1999, 52, 7
2000,  1,  3, 2000,  1, 1
2000,  1,  4, 2000,  1, 2
2000,  1,  5, 2000,  1, 3
2000,  1,  6, 2000,  1, 4
2000,  1,  7, 2000,  1, 5
2000,  1,  8, 2000,  1, 6
2000,  1,  9, 2000,  1, 7
2000, 12, 25, 2000, 52, 1
2000, 12, 26, 2000, 52, 2
2000, 12, 27, 2000, 52, 3
2000, 12, 28, 2000, 52, 4
2000, 12, 29, 2000, 52, 5
2000, 12, 30, 2000, 52, 6
2000, 12, 31, 2000, 52, 7
2001,  1,  1, 2001,  1, 1
2001,  1,  2, 2001,  1, 2
2001,  1,  3, 2001,  1, 3
2001,  1,  4, 2001,  1, 4
2001,  1,  5, 2001,  1, 5
2001,  1,  6, 2001,  1, 6
2001,  1,  7, 2001,  1, 7
2001, 12, 24, 2001, 52, 1
2001, 12, 25, 2001, 52, 2
2001, 12, 26, 2001, 52, 3
2001, 12, 27, 2001, 52, 4
2001, 12, 28, 2001, 52, 5
2001, 12, 29, 2001, 52, 6
2001, 12, 30, 2001, 52, 7
2001, 12, 31, 2002,  1, 1
2002,  1,  1, 2002,  1, 2
2002,  1,  2, 2002,  1, 3
2002,  1,  3, 2002,  1, 4
2002,  1,  4, 2002,  1, 5
2002,  1,  5, 2002,  1, 6
2002,  1,  6, 2002,  1, 7
2002, 12, 23, 2002, 52, 1
2002, 12, 24, 2002, 52, 2
2002, 12, 25, 2002, 52, 3
2002, 12, 26, 2002, 52, 4
2002, 12, 27, 2002, 52, 5
2002, 12, 28, 2002, 52, 6
2002, 12, 29, 2002, 52, 7
2002, 12, 30, 2003,  1, 1
2002, 12, 31, 2003,  1, 2
2003,  1,  1, 2003,  1, 3
2003,  1,  2, 2003,  1, 4
2003,  1,  3, 2003,  1, 5
2003,  1,  4, 2003,  1, 6
2003,  1,  5, 2003,  1, 7
2003, 12, 22, 2003, 52, 1
2003, 12, 23, 2003, 52, 2
2003, 12, 24, 2003, 52, 3
2003, 12, 25, 2003, 52, 4
2003, 12, 26, 2003, 52, 5
2003, 12, 27, 2003, 52, 6
2003, 12, 28, 2003, 52, 7
2003, 12, 29, 2004,  1, 1
2003, 12, 30, 2004,  1, 2
2003, 12, 31, 2004,  1, 3
2004,  1,  1, 2004,  1, 4
2004,  1,  2, 2004,  1, 5
2004,  1,  3, 2004,  1, 6
2004,  1,  4, 2004,  1, 7
2004, 12, 20, 2004, 52, 1
2004, 12, 21, 2004, 52, 2
2004, 12, 22, 2004, 52, 3
2004, 12, 23, 2004, 52, 4
2004, 12, 24, 2004, 52, 5
2004, 12, 25, 2004, 52, 6
2004, 12, 26, 2004, 52, 7
2004, 12, 27, 2004, 53, 1
2004, 12, 28, 2004, 53, 2
2004, 12, 29, 2004, 53, 3
2004, 12, 30, 2004, 53, 4
2004, 12, 31, 2004, 53, 5
2005,  1,  1, 2004, 53, 6
2005,  1,  2, 2004, 53, 7
2005,  1,  3, 2005,  1, 1
2005,  1,  4, 2005,  1, 2
2005,  1,  5, 2005,  1, 3
2005,  1,  6, 2005,  1, 4
2005,  1,  7, 2005,  1, 5
2005,  1,  8, 2005,  1, 6
2005,  1,  9, 2005,  1, 7
2005, 12, 26, 2005, 52, 1
2005, 12, 27, 2005, 52, 2
2005, 12, 28, 2005, 52, 3
2005, 12, 29, 2005, 52, 4
2005, 12, 30, 2005, 52, 5
2005, 12, 31, 2005, 52, 6
2006,  1,  1, 2005, 52, 7
2006,  1,  2, 2006,  1, 1
2006,  1,  3, 2006,  1, 2
2006,  1,  4, 2006,  1, 3
2006,  1,  5, 2006,  1, 4
2006,  1,  6, 2006,  1, 5
2006,  1,  7, 2006,  1, 6
2006,  1,  8, 2006,  1, 7
2006, 12, 25, 2006, 52, 1
2006, 12, 26, 2006, 52, 2
2006, 12, 27, 2006, 52, 3
2006, 12, 28, 2006, 52, 4
2006, 12, 29, 2006, 52, 5
2006, 12, 30, 2006, 52, 6
2006, 12, 31, 2006, 52, 7
2007,  1,  1, 2007,  1, 1
2007,  1,  2, 2007,  1, 2
2007,  1,  3, 2007,  1, 3
2007,  1,  4, 2007,  1, 4
2007,  1,  5, 2007,  1, 5
2007,  1,  6, 2007,  1, 6
2007,  1,  7, 2007,  1, 7
2007, 12, 24, 2007, 52, 1
2007, 12, 25, 2007, 52, 2
2007, 12, 26, 2007, 52, 3
2007, 12, 27, 2007, 52, 4
2007, 12, 28, 2007, 52, 5
2007, 12, 29, 2007, 52, 6
2007, 12, 30, 2007, 52, 7
2007, 12, 31, 2008,  1, 1
2008,  1,  1, 2008,  1, 2
2008,  1,  2, 2008,  1, 3
2008,  1,  3, 2008,  1, 4
2008,  1,  4, 2008,  1, 5
2008,  1,  5, 2008,  1, 6
2008,  1,  6, 2008,  1, 7
2008, 12, 22, 2008, 52, 1
2008, 12, 23, 2008, 52, 2
2008, 12, 24, 2008, 52, 3
2008, 12, 25, 2008, 52, 4
2008, 12, 26, 2008, 52, 5
2008, 12, 27, 2008, 52, 6
2008, 12, 28, 2008, 52, 7
2008, 12, 29, 2009,  1, 1
2008, 12, 30, 2009,  1, 2
2008, 12, 31, 2009,  1, 3
2009,  1,  1, 2009,  1, 4
2009,  1,  2, 2009,  1, 5
2009,  1,  3, 2009,  1, 6
2009,  1,  4, 2009,  1, 7
2009, 12, 21, 2009, 52, 1
2009, 12, 22, 2009, 52, 2
2009, 12, 23, 2009, 52, 3
2009, 12, 24, 2009, 52, 4
2009, 12, 25, 2009, 52, 5
2009, 12, 26, 2009, 52, 6
2009, 12, 27, 2009, 52, 7
2009, 12, 28, 2009, 53, 1
2009, 12, 29, 2009, 53, 2
2009, 12, 30, 2009, 53, 3
2009, 12, 31, 2009, 53, 4
2010,  1,  1, 2009, 53, 5
2010,  1,  2, 2009, 53, 6
2010,  1,  3, 2009, 53, 7
2010,  1,  4, 2010,  1, 1
2010,  1,  5, 2010,  1, 2
2010,  1,  6, 2010,  1, 3
2010,  1,  7, 2010,  1, 4
2010,  1,  8, 2010,  1, 5
2010,  1,  9, 2010,  1, 6
2010,  1, 10, 2010,  1, 7
2010, 12, 27, 2010, 52, 1
2010, 12, 28, 2010, 52, 2
2010, 12, 29, 2010, 52, 3
2010, 12, 30, 2010, 52, 4
2010, 12, 31, 2010, 52, 5
2011,  1,  1, 2010, 52, 6
2011,  1,  2, 2010, 52, 7
2011,  1,  3, 2011,  1, 1
2011,  1,  4, 2011,  1, 2
2011,  1,  5, 2011,  1, 3
2011,  1,  6, 2011,  1, 4
2011,  1,  7, 2011,  1, 5
2011,  1,  8, 2011,  1, 6
2011,  1,  9, 2011,  1, 7
2011, 12, 26, 2011, 52, 1
2011, 12, 27, 2011, 52, 2
2011, 12, 28, 2011, 52, 3
2011, 12, 29, 2011, 52, 4
2011, 12, 30, 2011, 52, 5
2011, 12, 31, 2011, 52, 6
2012,  1,  1, 2011, 52, 7
2012,  1,  2, 2012,  1, 1
2012,  1,  3, 2012,  1, 2
2012,  1,  4, 2012,  1, 3
2012,  1,  5, 2012,  1, 4
2012,  1,  6, 2012,  1, 5
2012,  1,  7, 2012,  1, 6
2012,  1,  8, 2012,  1, 7
2012, 12, 24, 2012, 52, 1
2012, 12, 25, 2012, 52, 2
2012, 12, 26, 2012, 52, 3
2012, 12, 27, 2012, 52, 4
2012, 12, 28, 2012, 52, 5
2012, 12, 29, 2012, 52, 6
2012, 12, 30, 2012, 52, 7
2012, 12, 31, 2013,  1, 1
2013,  1,  1, 2013,  1, 2
2013,  1,  2, 2013,  1, 3
2013,  1,  3, 2013,  1, 4
2013,  1,  4, 2013,  1, 5
2013,  1,  5, 2013,  1, 6
2013,  1,  6, 2013,  1, 7
2013, 12, 23, 2013, 52, 1
2013, 12, 24, 2013, 52, 2
2013, 12, 25, 2013, 52, 3
2013, 12, 26, 2013, 52, 4
2013, 12, 27, 2013, 52, 5
2013, 12, 28, 2013, 52, 6
2013, 12, 29, 2013, 52, 7
2013, 12, 30, 2014,  1, 1
2013, 12, 31, 2014,  1, 2
2014,  1,  1, 2014,  1, 3
2014,  1,  2, 2014,  1, 4
2014,  1,  3, 2014,  1, 5
2014,  1,  4, 2014,  1, 6
2014,  1,  5, 2014,  1, 7
2014, 12, 22, 2014, 52, 1
2014, 12, 23, 2014, 52, 2
2014, 12, 24, 2014, 52, 3
2014, 12, 25, 2014, 52, 4
2014, 12, 26, 2014, 52, 5
2014, 12, 27, 2014, 52, 6
2014, 12, 28, 2014, 52, 7
2014, 12, 29, 2015,  1, 1
2014, 12, 30, 2015,  1, 2
2014, 12, 31, 2015,  1, 3
2015,  1,  1, 2015,  1, 4
2015,  1,  2, 2015,  1, 5
2015,  1,  3, 2015,  1, 6
2015,  1,  4, 2015,  1, 7
2015, 12, 21, 2015, 52, 1
2015, 12, 22, 2015, 52, 2
2015, 12, 23, 2015, 52, 3
2015, 12, 24, 2015, 52, 4
2015, 12, 25, 2015, 52, 5
2015, 12, 26, 2015, 52, 6
2015, 12, 27, 2015, 52, 7
2015, 12, 28, 2015, 53, 1
2015, 12, 29, 2015, 53, 2
2015, 12, 30, 2015, 53, 3
2015, 12, 31, 2015, 53, 4
2016,  1,  1, 2015, 53, 5
2016,  1,  2, 2015, 53, 6
2016,  1,  3, 2015, 53, 7
2016,  1,  4, 2016,  1, 1
2016,  1,  5, 2016,  1, 2
2016,  1,  6, 2016,  1, 3
2016,  1,  7, 2016,  1, 4
2016,  1,  8, 2016,  1, 5
2016,  1,  9, 2016,  1, 6
2016,  1, 10, 2016,  1, 7
2016, 12, 26, 2016, 52, 1
2016, 12, 27, 2016, 52, 2
2016, 12, 28, 2016, 52, 3
2016, 12, 29, 2016, 52, 4
2016, 12, 30, 2016, 52, 5
2016, 12, 31, 2016, 52, 6
2017,  1,  1, 2016, 52, 7
2017,  1,  2, 2017,  1, 1
2017,  1,  3, 2017,  1, 2
2017,  1,  4, 2017,  1, 3
2017,  1,  5, 2017,  1, 4
2017,  1,  6, 2017,  1, 5
2017,  1,  7, 2017,  1, 6
2017,  1,  8, 2017,  1, 7
2017, 12, 25, 2017, 52, 1
2017, 12, 26, 2017, 52, 2
2017, 12, 27, 2017, 52, 3
2017, 12, 28, 2017, 52, 4
2017, 12, 29, 2017, 52, 5
2017, 12, 30, 2017, 52, 6
2017, 12, 31, 2017, 52, 7
2018,  1,  1, 2018,  1, 1
2018,  1,  2, 2018,  1, 2
2018,  1,  3, 2018,  1, 3
2018,  1,  4, 2018,  1, 4
2018,  1,  5, 2018,  1, 5
2018,  1,  6, 2018,  1, 6
2018,  1,  7, 2018,  1, 7
2018, 12, 24, 2018, 52, 1
2018, 12, 25, 2018, 52, 2
2018, 12, 26, 2018, 52, 3
2018, 12, 27, 2018, 52, 4
2018, 12, 28, 2018, 52, 5
2018, 12, 29, 2018, 52, 6
2018, 12, 30, 2018, 52, 7
2018, 12, 31, 2019,  1, 1
2019,  1,  1, 2019,  1, 2
2019,  1,  2, 2019,  1, 3
2019,  1,  3, 2019,  1, 4
2019,  1,  4, 2019,  1, 5
2019,  1,  5, 2019,  1, 6
2019,  1,  6, 2019,  1, 7
2019, 12, 23, 2019, 52, 1
2019, 12, 24, 2019, 52, 2
2019, 12, 25, 2019, 52, 3
2019, 12, 26, 2019, 52, 4
2019, 12, 27, 2019, 52, 5
2019, 12, 28, 2019, 52, 6
2019, 12, 29, 2019, 52, 7
2019, 12, 30, 2020,  1, 1
2019, 12, 31, 2020,  1, 2
2020,  1,  1, 2020,  1, 3
2020,  1,  2, 2020,  1, 4
2020,  1,  3, 2020,  1, 5
2020,  1,  4, 2020,  1, 6
2020,  1,  5, 2020,  1, 7
2020, 12, 21, 2020, 52, 1
2020, 12, 22, 2020, 52, 2
2020, 12, 23, 2020, 52, 3
2020, 12, 24, 2020, 52, 4
2020, 12, 25, 2020, 52, 5
2020, 12, 26, 2020, 52, 6
2020, 12, 27, 2020, 52, 7
2020, 12, 28, 2020, 53, 1
2020, 12, 29, 2020, 53, 2
2020, 12, 30, 2020, 53, 3
2020, 12, 31, 2020, 53, 4
2021,  1,  1, 2020, 53, 5
2021,  1,  2, 2020, 53, 6
2021,  1,  3, 2020, 53, 7
2021,  1,  4, 2021,  1, 1
2021,  1,  5, 2021,  1, 2
2021,  1,  6, 2021,  1, 3
2021,  1,  7, 2021,  1, 4
2021,  1,  8, 2021,  1, 5
2021,  1,  9, 2021,  1, 6
2021,  1, 10, 2021,  1, 7
2021, 12, 27, 2021, 52, 1
2021, 12, 28, 2021, 52, 2
2021, 12, 29, 2021, 52, 3
2021, 12, 30, 2021, 52, 4
2021, 12, 31, 2021, 52, 5
2022,  1,  1, 2021, 52, 6
2022,  1,  2, 2021, 52, 7
2022,  1,  3, 2022,  1, 1
2022,  1,  4, 2022,  1, 2
2022,  1,  5, 2022,  1, 3
2022,  1,  6, 2022,  1, 4
2022,  1,  7, 2022,  1, 5
2022,  1,  8, 2022,  1, 6
2022,  1,  9, 2022,  1, 7
2022, 12, 26, 2022, 52, 1
2022, 12, 27, 2022, 52, 2
2022, 12, 28, 2022, 52, 3
2022, 12, 29, 2022, 52, 4
2022, 12, 30, 2022, 52, 5
2022, 12, 31, 2022, 52, 6
2023,  1,  1, 2022, 52, 7
2023,  1,  2, 2023,  1, 1
2023,  1,  3, 2023,  1, 2
2023,  1,  4, 2023,  1, 3
2023,  1,  5, 2023,  1, 4
2023,  1,  6, 2023,  1, 5
2023,  1,  7, 2023,  1, 6
2023,  1,  8, 2023,  1, 7
2023, 12, 25, 2023, 52, 1
2023, 12, 26, 2023, 52, 2
2023, 12, 27, 2023, 52, 3
2023, 12, 28, 2023, 52, 4
2023, 12, 29, 2023, 52, 5
2023, 12, 30, 2023, 52, 6
2023, 12, 31, 2023, 52, 7
2024,  1,  1, 2024,  1, 1
2024,  1,  2, 2024,  1, 2
2024,  1,  3, 2024,  1, 3
2024,  1,  4, 2024,  1, 4
2024,  1,  5, 2024,  1, 5
2024,  1,  6, 2024,  1, 6
2024,  1,  7, 2024,  1, 7
2024, 12, 23, 2024, 52, 1
2024, 12, 24, 2024, 52, 2
2024, 12, 25, 2024, 52, 3
2024, 12, 26, 2024, 52, 4
2024, 12, 27, 2024, 52, 5
2024, 12, 28, 2024, 52, 6
2024, 12, 29, 2024, 52, 7
2024, 12, 30, 2025,  1, 1
2024, 12, 31, 2025,  1, 2
2025,  1,  1, 2025,  1, 3
2025,  1,  2, 2025,  1, 4
2025,  1,  3, 2025,  1, 5
2025,  1,  4, 2025,  1, 6
2025,  1,  5, 2025,  1, 7
2025, 12, 22, 2025, 52, 1
2025, 12, 23, 2025, 52, 2
2025, 12, 24, 2025, 52, 3
2025, 12, 25, 2025, 52, 4
2025, 12, 26, 2025, 52, 5
2025, 12, 27, 2025, 52, 6
2025, 12, 28, 2025, 52, 7
2025, 12, 29, 2026,  1, 1
2025, 12, 30, 2026,  1, 2
2025, 12, 31, 2026,  1, 3
2026,  1,  1, 2026,  1, 4
2026,  1,  2, 2026,  1, 5
2026,  1,  3, 2026,  1, 6
2026,  1,  4, 2026,  1, 7
2026, 12, 21, 2026, 52, 1
2026, 12, 22, 2026, 52, 2
2026, 12, 23, 2026, 52, 3
2026, 12, 24, 2026, 52, 4
2026, 12, 25, 2026, 52, 5
2026, 12, 26, 2026, 52, 6
2026, 12, 27, 2026, 52, 7
2026, 12, 28, 2026, 53, 1
2026, 12, 29, 2026, 53, 2
2026, 12, 30, 2026, 53, 3
2026, 12, 31, 2026, 53, 4
2027,  1,  1, 2026, 53, 5
2027,  1,  2, 2026, 53, 6
2027,  1,  3, 2026, 53, 7
2027,  1,  4, 2027,  1, 1
2027,  1,  5, 2027,  1, 2
2027,  1,  6, 2027,  1, 3
2027,  1,  7, 2027,  1, 4
2027,  1,  8, 2027,  1, 5
2027,  1,  9, 2027,  1, 6
2027,  1, 10, 2027,  1, 7
2027, 12, 27, 2027, 52, 1
2027, 12, 28, 2027, 52, 2
2027, 12, 29, 2027, 52, 3
2027, 12, 30, 2027, 52, 4
2027, 12, 31, 2027, 52, 5
2028,  1,  1, 2027, 52, 6
2028,  1,  2, 2027, 52, 7
2028,  1,  3, 2028,  1, 1
2028,  1,  4, 2028,  1, 2
2028,  1,  5, 2028,  1, 3
2028,  1,  6, 2028,  1, 4
2028,  1,  7, 2028,  1, 5
2028,  1,  8, 2028,  1, 6
2028,  1,  9, 2028,  1, 7
2028, 12, 25, 2028, 52, 1
2028, 12, 26, 2028, 52, 2
2028, 12, 27, 2028, 52, 3
2028, 12, 28, 2028, 52, 4
2028, 12, 29, 2028, 52, 5
2028, 12, 30, 2028, 52, 6
2028, 12, 31, 2028, 52, 7
2029,  1,  1, 2029,  1, 1
2029,  1,  2, 2029,  1, 2
2029,  1,  3, 2029,  1, 3
2029,  1,  4, 2029,  1, 4
2029,  1,  5, 2029,  1, 5
2029,  1,  6, 2029,  1, 6
2029,  1,  7, 2029,  1, 7
