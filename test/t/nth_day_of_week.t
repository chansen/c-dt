#!perl
use strict;
use warnings;

use Test::More 0.88;
use dtp qw[:all];

my $base = dt_from_ymd(2012, 6, 1);

while (<DATA>) {
    next if /\A \# /x;
    chomp;
    my ($y, $m, $d, $nth, $dow) = split /,\s*/, $_;

    my $ymd = sprintf '%.4d-%.2d-%.2d', $y, $m, $d;
    {
        my $got = dt_nth_day_of_week($base, $nth, $dow);
        my $str = sprintf '%.4d-%.2d-%.2d', dt_to_ymd($got);
        is($str, $ymd, "dt_to_ymd(dt_nth_day_of_week($base, $nth, $dow))");
        is(dt_day_of_week($got), $dow, "dt_day_of_week($got)");
    }
}

done_testing;

__DATA__
# year, month, day, nth, dow
2012,  1, 16, -20, 1
2012,  1, 23, -19, 1
2012,  1, 30, -18, 1
2012,  2,  6, -17, 1
2012,  2, 13, -16, 1
2012,  2, 20, -15, 1
2012,  2, 27, -14, 1
2012,  3,  5, -13, 1
2012,  3, 12, -12, 1
2012,  3, 19, -11, 1
2012,  3, 26, -10, 1
2012,  4,  2,  -9, 1
2012,  4,  9,  -8, 1
2012,  4, 16,  -7, 1
2012,  4, 23,  -6, 1
2012,  4, 30,  -5, 1
2012,  5,  7,  -4, 1
2012,  5, 14,  -3, 1
2012,  5, 21,  -2, 1
2012,  5, 28,  -1, 1
2012,  6,  4,   1, 1
2012,  6, 11,   2, 1
2012,  6, 18,   3, 1
2012,  6, 25,   4, 1
2012,  7,  2,   5, 1
2012,  7,  9,   6, 1
2012,  7, 16,   7, 1
2012,  7, 23,   8, 1
2012,  7, 30,   9, 1
2012,  8,  6,  10, 1
2012,  8, 13,  11, 1
2012,  8, 20,  12, 1
2012,  8, 27,  13, 1
2012,  9,  3,  14, 1
2012,  9, 10,  15, 1
2012,  9, 17,  16, 1
2012,  9, 24,  17, 1
2012, 10,  1,  18, 1
2012, 10,  8,  19, 1
2012, 10, 15,  20, 1
2012,  1, 17, -20, 2
2012,  1, 24, -19, 2
2012,  1, 31, -18, 2
2012,  2,  7, -17, 2
2012,  2, 14, -16, 2
2012,  2, 21, -15, 2
2012,  2, 28, -14, 2
2012,  3,  6, -13, 2
2012,  3, 13, -12, 2
2012,  3, 20, -11, 2
2012,  3, 27, -10, 2
2012,  4,  3,  -9, 2
2012,  4, 10,  -8, 2
2012,  4, 17,  -7, 2
2012,  4, 24,  -6, 2
2012,  5,  1,  -5, 2
2012,  5,  8,  -4, 2
2012,  5, 15,  -3, 2
2012,  5, 22,  -2, 2
2012,  5, 29,  -1, 2
2012,  6,  5,   1, 2
2012,  6, 12,   2, 2
2012,  6, 19,   3, 2
2012,  6, 26,   4, 2
2012,  7,  3,   5, 2
2012,  7, 10,   6, 2
2012,  7, 17,   7, 2
2012,  7, 24,   8, 2
2012,  7, 31,   9, 2
2012,  8,  7,  10, 2
2012,  8, 14,  11, 2
2012,  8, 21,  12, 2
2012,  8, 28,  13, 2
2012,  9,  4,  14, 2
2012,  9, 11,  15, 2
2012,  9, 18,  16, 2
2012,  9, 25,  17, 2
2012, 10,  2,  18, 2
2012, 10,  9,  19, 2
2012, 10, 16,  20, 2
2012,  1, 18, -20, 3
2012,  1, 25, -19, 3
2012,  2,  1, -18, 3
2012,  2,  8, -17, 3
2012,  2, 15, -16, 3
2012,  2, 22, -15, 3
2012,  2, 29, -14, 3
2012,  3,  7, -13, 3
2012,  3, 14, -12, 3
2012,  3, 21, -11, 3
2012,  3, 28, -10, 3
2012,  4,  4,  -9, 3
2012,  4, 11,  -8, 3
2012,  4, 18,  -7, 3
2012,  4, 25,  -6, 3
2012,  5,  2,  -5, 3
2012,  5,  9,  -4, 3
2012,  5, 16,  -3, 3
2012,  5, 23,  -2, 3
2012,  5, 30,  -1, 3
2012,  6,  6,   1, 3
2012,  6, 13,   2, 3
2012,  6, 20,   3, 3
2012,  6, 27,   4, 3
2012,  7,  4,   5, 3
2012,  7, 11,   6, 3
2012,  7, 18,   7, 3
2012,  7, 25,   8, 3
2012,  8,  1,   9, 3
2012,  8,  8,  10, 3
2012,  8, 15,  11, 3
2012,  8, 22,  12, 3
2012,  8, 29,  13, 3
2012,  9,  5,  14, 3
2012,  9, 12,  15, 3
2012,  9, 19,  16, 3
2012,  9, 26,  17, 3
2012, 10,  3,  18, 3
2012, 10, 10,  19, 3
2012, 10, 17,  20, 3
2012,  1, 19, -20, 4
2012,  1, 26, -19, 4
2012,  2,  2, -18, 4
2012,  2,  9, -17, 4
2012,  2, 16, -16, 4
2012,  2, 23, -15, 4
2012,  3,  1, -14, 4
2012,  3,  8, -13, 4
2012,  3, 15, -12, 4
2012,  3, 22, -11, 4
2012,  3, 29, -10, 4
2012,  4,  5,  -9, 4
2012,  4, 12,  -8, 4
2012,  4, 19,  -7, 4
2012,  4, 26,  -6, 4
2012,  5,  3,  -5, 4
2012,  5, 10,  -4, 4
2012,  5, 17,  -3, 4
2012,  5, 24,  -2, 4
2012,  5, 31,  -1, 4
2012,  6,  7,   1, 4
2012,  6, 14,   2, 4
2012,  6, 21,   3, 4
2012,  6, 28,   4, 4
2012,  7,  5,   5, 4
2012,  7, 12,   6, 4
2012,  7, 19,   7, 4
2012,  7, 26,   8, 4
2012,  8,  2,   9, 4
2012,  8,  9,  10, 4
2012,  8, 16,  11, 4
2012,  8, 23,  12, 4
2012,  8, 30,  13, 4
2012,  9,  6,  14, 4
2012,  9, 13,  15, 4
2012,  9, 20,  16, 4
2012,  9, 27,  17, 4
2012, 10,  4,  18, 4
2012, 10, 11,  19, 4
2012, 10, 18,  20, 4
2012,  1, 20, -20, 5
2012,  1, 27, -19, 5
2012,  2,  3, -18, 5
2012,  2, 10, -17, 5
2012,  2, 17, -16, 5
2012,  2, 24, -15, 5
2012,  3,  2, -14, 5
2012,  3,  9, -13, 5
2012,  3, 16, -12, 5
2012,  3, 23, -11, 5
2012,  3, 30, -10, 5
2012,  4,  6,  -9, 5
2012,  4, 13,  -8, 5
2012,  4, 20,  -7, 5
2012,  4, 27,  -6, 5
2012,  5,  4,  -5, 5
2012,  5, 11,  -4, 5
2012,  5, 18,  -3, 5
2012,  5, 25,  -2, 5
2012,  6,  1,  -1, 5
2012,  6,  1,   1, 5
2012,  6,  8,   2, 5
2012,  6, 15,   3, 5
2012,  6, 22,   4, 5
2012,  6, 29,   5, 5
2012,  7,  6,   6, 5
2012,  7, 13,   7, 5
2012,  7, 20,   8, 5
2012,  7, 27,   9, 5
2012,  8,  3,  10, 5
2012,  8, 10,  11, 5
2012,  8, 17,  12, 5
2012,  8, 24,  13, 5
2012,  8, 31,  14, 5
2012,  9,  7,  15, 5
2012,  9, 14,  16, 5
2012,  9, 21,  17, 5
2012,  9, 28,  18, 5
2012, 10,  5,  19, 5
2012, 10, 12,  20, 5
2012,  1, 14, -20, 6
2012,  1, 21, -19, 6
2012,  1, 28, -18, 6
2012,  2,  4, -17, 6
2012,  2, 11, -16, 6
2012,  2, 18, -15, 6
2012,  2, 25, -14, 6
2012,  3,  3, -13, 6
2012,  3, 10, -12, 6
2012,  3, 17, -11, 6
2012,  3, 24, -10, 6
2012,  3, 31,  -9, 6
2012,  4,  7,  -8, 6
2012,  4, 14,  -7, 6
2012,  4, 21,  -6, 6
2012,  4, 28,  -5, 6
2012,  5,  5,  -4, 6
2012,  5, 12,  -3, 6
2012,  5, 19,  -2, 6
2012,  5, 26,  -1, 6
2012,  6,  2,   1, 6
2012,  6,  9,   2, 6
2012,  6, 16,   3, 6
2012,  6, 23,   4, 6
2012,  6, 30,   5, 6
2012,  7,  7,   6, 6
2012,  7, 14,   7, 6
2012,  7, 21,   8, 6
2012,  7, 28,   9, 6
2012,  8,  4,  10, 6
2012,  8, 11,  11, 6
2012,  8, 18,  12, 6
2012,  8, 25,  13, 6
2012,  9,  1,  14, 6
2012,  9,  8,  15, 6
2012,  9, 15,  16, 6
2012,  9, 22,  17, 6
2012,  9, 29,  18, 6
2012, 10,  6,  19, 6
2012, 10, 13,  20, 6
2012,  1, 15, -20, 7
2012,  1, 22, -19, 7
2012,  1, 29, -18, 7
2012,  2,  5, -17, 7
2012,  2, 12, -16, 7
2012,  2, 19, -15, 7
2012,  2, 26, -14, 7
2012,  3,  4, -13, 7
2012,  3, 11, -12, 7
2012,  3, 18, -11, 7
2012,  3, 25, -10, 7
2012,  4,  1,  -9, 7
2012,  4,  8,  -8, 7
2012,  4, 15,  -7, 7
2012,  4, 22,  -6, 7
2012,  4, 29,  -5, 7
2012,  5,  6,  -4, 7
2012,  5, 13,  -3, 7
2012,  5, 20,  -2, 7
2012,  5, 27,  -1, 7
2012,  6,  3,   1, 7
2012,  6, 10,   2, 7
2012,  6, 17,   3, 7
2012,  6, 24,   4, 7
2012,  7,  1,   5, 7
2012,  7,  8,   6, 7
2012,  7, 15,   7, 7
2012,  7, 22,   8, 7
2012,  7, 29,   9, 7
2012,  8,  5,  10, 7
2012,  8, 12,  11, 7
2012,  8, 19,  12, 7
2012,  8, 26,  13, 7
2012,  9,  2,  14, 7
2012,  9,  9,  15, 7
2012,  9, 16,  16, 7
2012,  9, 23,  17, 7
2012,  9, 30,  18, 7
2012, 10,  7,  19, 7
2012, 10, 14,  20, 7
